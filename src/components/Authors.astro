---
import type { Author } from "../types/types";

interface Props {
  authors: Author[];
}

const { authors } = Astro.props;

// Group authors by institution
const groupedByInstitution = authors.reduce((acc, author) => {
  const institution = author.institution || "Unknown";
  if (!acc[institution]) {
    acc[institution] = [];
  }
  acc[institution].push(author);
  return acc;
}, {} as Record<string, Author[]>);
---

<div class="flex flex-row gap-x-8 gap-y-4 flex-wrap justify-center">
  {
    Object.entries(groupedByInstitution).map(([institution, institutionAuthors]) => (
      <div class="flex flex-col items-center text-center">
        <div class="flex flex-row gap-x-2 gap-y-2 flex-wrap justify-center">
          {
            institutionAuthors.map((author, index) => (
              <span class="text-xl flex flex-row">
                {author.url ? (
                  <a href={author.url} class="">
                    {author.name}
                  </a>
                ) : (
                  author.name
                )}
                {author.notes && (
                  <sup class="text-xl">
                    {author.notes.map(
                      (note, noteIndex, array) =>
                        note + (noteIndex < array.length - 1 ? "," : "")
                    )}
                  </sup>
                )}
                {index < institutionAuthors.length - 1 && <span class="mx-1">,</span>}
              </span>
            ))
          }
        </div>
        {institution && institution !== "Unknown" && <p>{institution}</p>}
      </div>
    ))
  }
</div>
